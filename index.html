<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>正在加载...</title>

    <!-- 阻塞式加载外部配置，确保首屏不闪烁 -->
    <script>
      // 设置默认配置，防止 /config.json 加载失败
      window.APP_CONFIG = {
        basic: {
          app_name: "加载失败",
          strapi_url: "",
          strapi_site_slug: "error",
          gtmId: "GTM-XXXXXX",
          seo: { title: "", description: "", keywords: "" },
          hero: { slogan: "", description: "" }
        },
        extra: {}
      };

      try {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '/config.json', false); // 同步阻塞
        xhr.send(null);
        if (xhr.status === 200) {
          window.APP_CONFIG = JSON.parse(xhr.responseText);
        } else {
          console.warn('无法加载外部 config.json，将使用默认配置。');
        }
      } catch (error) {
        console.error('加载 config.json 时出错:', error);
      }

      // 根据配置动态注入 GTM
      (function(w,d,s,l){
        var gtmId = (w.APP_CONFIG && w.APP_CONFIG.basic && w.APP_CONFIG.basic.gtmId) || 'GTM-XXXXXX';
        w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
        var f=d.getElementsByTagName(s)[0], j=d.createElement(s), dl=l!='dataLayer'?'&l='+l:'';
        j.async=true; j.src='https://www.googletagmanager.com/gtm.js?id='+gtmId+dl;
        f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer');
    </script>
  </head>

  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
